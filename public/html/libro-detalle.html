<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libros Del Pobre Mundo | Libros</title>
    <link rel="stylesheet" href="../css/styles.css">
    <link rel="shortcut icon" href="../img/logotipos/icono.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .button-container {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            width: 100%;
        }
        .buy-button, .cart-button-detalle {
            flex: 1;
            padding: 10px;
            background-color: #9E0001;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 14px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            box-sizing: border-box; 
            white-space: nowrap; 
            height: 50px;
        }
        .buy-button:hover, .cart-button-detalle:hover {
            background-color: black;
            transition: 0.3s;
        }
        .buy-button i, .cart-button-detalle i {
            margin-right: 5px;
        }
        /* Titulos */
        .novedades-section {
            text-align: center;
            margin: 50px 0;
        }
        .novedades-section h2 {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px; /* Titulo ajustado */
            color: #9E0001;
            font-weight: bold;
        }
        .novedades-section h2 span {
            flex: 1;
            height: 5px;
            background-color: #9E0001;
            margin: 0 50px; /* Ajustado el margen */
            border-radius: 20px;
        }

        /* Carrusel */
        .carousel-container {
            max-width: 90%;
            margin: 0 auto;
            overflow: hidden;
            position: relative;
        }
        .carousel-track {
            display: flex;
            transition: transform 0.3s ease-in-out;
        }
        .carousel-slide {
            min-width: 200px;
            margin-right: 20px;
        }
        .carousel-slide img {
            width: 180px;
            height: 280px;
            object-fit: cover;
            margin: 0 auto 15px;
            display: block;
        }
        .carousel-buttons {
            position: absolute;
            top: 50%;
            width: 100%;
            display: flex;
            justify-content: space-between;
            transform: translateY(-50%);
        }
        .carousel-button {
            background-color: #9E0001;
            color: white;
            border: none;
            cursor: pointer;
            padding: 10px;
        }
        .carousel-button.prev {
            left: 0;
        }
        .carousel-button.next {
            right: 0;
        }
        .book-info {
            padding: 10px;
        }
        .book-title {
            font-size: 16px;
            color: #000;
            margin: 10px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .book-author {
            font-size: 12px;
            color: #555;
            margin-bottom: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .book-price {
            font-size: 14px;
            color: #9E0001;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .more-button {
            padding: 6px 12px;
            background-color: #9E0001;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 12px;
            display: block;
            width: 100%;
            text-align: center;
        }
        .more-button:hover {
            background-color: black;
            transition: 0.3s;
        }

        /* Media Queries */
        @media (max-width: 768px) {
            .novedades-section h2 {
                font-size: 20px;
            }
            .novedades-section h2 span {
                margin: 0 20px;
            }
            .carousel-slide img {
                width: 150px;
                height: 230px;
            }
            .carousel-slide {
                min-width: 150px;
                margin-right: 10px;
            }
        }
        @media (max-width: 480px) {
            .novedades-section h2 {
                font-size: 18px;
            }
            .novedades-section h2 span {
                margin: 0 10px;
            }
            .carousel-slide img {
                width: 120px; 
                height: 200px;
            }
            .carousel-slide {
                min-width: 120px; 
                margin-right: 5px;
            }
        }
    </style>
</head>
<body>
    <div class="top-banner">
        <p>Envios a todo el país | Más de 20.000 títulos en nuestro catálogo | Consultar disponibilidad</p>
    </div>
    <header>
        <div class="header-container">
            <div class="logo">
                <img src="../img/logotipos/blanco.png" alt="Logotipo Libros del pobre mundo">
            </div>
            <div class="hamburger-menu" onclick="toggleMenu()">
                &#9776;
            </div>
        </div>
        <nav id="nav-menu">
            <div class="close-menu" onclick="toggleMenu()">&#10005;</div>
            <ul>
                <li><a href="../../index.html">INICIO</a></li>
                <li><a href="../../catalogo.html">CATÁLOGO</a></li>
                <li><a href="../../podcastyreseñas.html">PODCAST Y RESEÑAS</a></li>
                <li><a href="../../contacto.html">CONTACTO</a></li>
            </ul>
        </nav>
    </header>
    <main>
        <div class="container">
            <section id="book-details" class="book-details">
                <div class="details-container" id="details-content">
                    <!-- Contenido dinámico cargado aquí -->
                </div>
            </section>
            <div class="novedades-section">
                <h2><span></span>MÁS LIBROS DE NUESTRO CATÁLOGO<span></span></h2>
            </div>
            <div class="carousel-container">
                <div class="carousel-track" id="carousel-track">
                    <!-- Libros al azar cargados aquí -->
                </div>
                <div class="carousel-buttons">
                    <button class="carousel-button prev" id="prev-button">&#10094;</button>
                    <button class="carousel-button next" id="next-button">&#10095;</button>
                </div>
            </div>
        </div>
        <div id="cart-icon-container">
            <i class="fas fa-shopping-cart"></i>
            <span id="cart-count">0</span>
        </div>
        <div id="cart-container" style="display:none;">
            <div id="cart-list"></div>
            <button id="send-whatsapp-button" onclick="sendCartToWhatsApp()">Enviar Pedido</button>
        </div>
    </main>
    <footer>
        <div class="footer-content">
            <p>Todos los derechos reservados © 2024 Libros Del Pobre Mundo - Librería Online</p>
            <p>Diseño por <a href="">codeviciadodev</a></p>
            <div class="payment-methods">
                <p>Métodos de pagos y transferencia:</p>
                <img src="../img/pagos/mercadopago.png" alt="Método de pago 1">
                <img src="../img/pagos/itau.png" alt="Método de pago 2">
                <img src="../img/pagos/prex.png" alt="Método de pago 3">
                <img src="../img/pagos/oca blue.png" alt="Método de pago 4">
            </div>
        </div>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const bookId = urlParams.get('id');
            fetch('../../libros.json')
                .then(response => response.json())
                .then(data => {
                    const libro = data.find(libro => libro.id == bookId);
                    if (libro) {
                        const detailsContent = document.getElementById('details-content');
                        const imagePath = `../../${libro.imagen}`;
    
                        const precioOriginal = parseFloat(libro.precio.replace('UYU ', ''));
                        const precioDescuento = Math.round(precioOriginal * 0.95);
    
                        const estado = libro.estado || 'Desconocido';
                        const estadoClase = estado.toLowerCase().includes('nuevo') ? 'nuevo' : 'usado';
    
                        detailsContent.innerHTML = `
                            <div class="details-left" style="position: relative;">
                                <img src="${imagePath}" alt="${libro.titulo}">
                                ${estado !== 'Desconocido' ? `<div class="book-status ${estadoClase}">${estado}</div>` : ''}
                            </div>
                            <div class="details-right">
                                <h1 class="book-title">${libro.titulo}</h1>
                                <p class="book-author">${libro.autor}</p>
                                <p class="book-editorial"><strong>Editorial:</strong> ${libro.editorial}</p>
                                <p class="book-isbn"><strong>ISBN:</strong> ${libro.isbn}</p>
                                <p class="book-price"><strong>Precio:</strong> <span class="original-price">UYU ${precioOriginal}</span> <span class="discounted-price">UYU ${precioDescuento}</span> (5%)</p>
                                <p class="book-pages"><strong>Número de páginas:</strong> ${libro.numPaginas}</p>
                                <p class="book-description">${libro.descripcion}</p>
                                <div class="button-container">
                                    <button class="buy-button" data-whatsapp="59894090711">Comprar</button>
                                    <button class="cart-button-detalle" onclick="addToCart(${libro.id})"><i class="fas fa-shopping-cart"></i> Añadir</button>
                                </div>  
                                <div class="shipping-info">
                                    <h3>Envíos a todo el país por DAC.</h3>
                                </div>
                                <div class="payment-info">
                                    <img src="../img/pagos/mercadopago rojo.png" alt="Mercado Pago">
                                    <img src="../img/pagos/itau rojo.png" alt="Itau">
                                    <img src="../img/pagos/prex rojo.png" alt="Prex">
                                    <img src="../img/pagos/oca blue rojo.png" alt="Oca Blue">
                                </div>
                            </div>
                        `;
                        document.querySelector('.buy-button').addEventListener('click', (e) => {
                            const whatsappNumber = e.target.getAttribute('data-whatsapp');
                            const whatsappUrl = `https://wa.me/${whatsappNumber}?text=Hola,%20estoy%20interesado%20en%20comprar%20el%20libro%20${libro.titulo}%20de%20${libro.autor}`;
                            window.open(whatsappUrl, '_blank');
                        });
    
                        // LIBROS AL AZAR DE CARRUSEL
                        const randomBooks = getRandomBooks(data.filter(item => item.id != bookId), 20); 
                        const carouselTrack = document.getElementById('carousel-track');
                        randomBooks.forEach(libro => {
                            const bookSlide = document.createElement('div');
                            bookSlide.className = 'carousel-slide';
                            bookSlide.innerHTML = `
                                <img src="../../${libro.imagen}" alt="${libro.titulo}">
                                <div class="book-info">
                                    <h3 class="book-title">${libro.titulo}</h3>
                                    <p class="book-author">${libro.autor}</p>
                                    <p class="book-price">${libro.precio}</p>
                                    <button class="more-button" onclick="verMas(${libro.id})">Ver más</button>
                                </div>
                            `;
                            carouselTrack.appendChild(bookSlide);
                        });
    
                        // INICIAR CARRUSEL
                        initCarousel();
                    } else {
                        document.getElementById('details-content').innerHTML = '<p>Libro no encontrado.</p>';
                    }
                })
                .catch(error => console.error('Error al cargar el archivo JSON:', error));
        });
    
        function getRandomBooks(data, count) {
            const shuffled = data.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }
    
        function verMas(id) {
            window.location.href = `libro-detalle.html?id=${id}`;
        }
    
        function toggleMenu() {
            var menu = document.getElementById("nav-menu");
            var body = document.body;
            if (menu.classList.contains('open')) {
                menu.classList.remove('open');
                menu.classList.add('close');
                body.classList.remove('menu-open');
            } else {
                menu.classList.remove('close');
                menu.classList.add('open');
                body.classList.add('menu-open');
            }
        }
    
        function initCarousel() {
            const track = document.getElementById('carousel-track');
            const slides = Array.from(track.children);
            const nextButton = document.getElementById('next-button');
            const prevButton = document.getElementById('prev-button');
            const slideWidth = slides[0].getBoundingClientRect().width;
    
            slides.forEach((slide, index) => {
                slide.style.left = slideWidth * index + 'px';
            });
    
            let currentSlideIndex = 0;
    
            nextButton.addEventListener('click', () => {
                currentSlideIndex = (currentSlideIndex + 1) % slides.length;
                track.style.transform = `translateX(-${slideWidth * currentSlideIndex}px)`;
            });
    
            prevButton.addEventListener('click', () => {
                currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
                track.style.transform = `translateX(-${slideWidth * currentSlideIndex}px)`;
            });
        }
        
        // CARRITO DE COMPRAR
        function addToCart(bookId) {
    const cart = JSON.parse(sessionStorage.getItem('cart')) || [];
    if (!cart.includes(bookId)) {
        cart.push(bookId);
        sessionStorage.setItem('cart', JSON.stringify(cart));
        updateCartCount();
        displayCart();
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    const bookId = urlParams.get('id');
    fetch('../../libros.json')
        .then(response => response.json())
        .then(data => {
            librosData = data;
            const libro = data.find(libro => libro.id == bookId);
            if (libro) {
                const detailsContent = document.getElementById('details-content');
                const imagePath = `../../${libro.imagen}`;

                const precioOriginal = parseFloat(libro.precio.replace('UYU ', ''));
                const precioDescuento = Math.round(precioOriginal * 0.95);

                const estado = libro.estado || 'Desconocido';
                const estadoClase = estado.toLowerCase().includes('nuevo') ? 'nuevo' : 'usado';

                detailsContent.innerHTML = `
                    <div class="details-left" style="position: relative;">
                        <img src="${imagePath}" alt="${libro.titulo}">
                        ${estado !== 'Desconocido' ? `<div class="book-status ${estadoClase}">${estado}</div>` : ''}
                    </div>
                    <div class="details-right">
                        <h1 class="book-title">${libro.titulo}</h1>
                        <p class="book-author">${libro.autor}</p>
                        <p class="book-editorial"><strong>Editorial:</strong> ${libro.editorial}</p>
                        <p class="book-isbn"><strong>ISBN:</strong> ${libro.isbn}</p>
                        <p class="book-price"><strong>Precio:</strong> <span class="original-price">UYU ${precioOriginal}</span> <span class="discounted-price">UYU ${precioDescuento}</span> (5%)</p>
                        <p class="book-pages"><strong>Número de páginas:</strong> ${libro.numPaginas}</p>
                        <p class="book-description">${libro.descripcion}</p>
                                <div class="button-container">
                                    <button class="buy-button" data-whatsapp="59894090711">Comprar</button>
                                    <button class="cart-button-detalle" onclick="addToCart(${libro.id})"><i class="fas fa-shopping-cart"></i> Añadir</button>
                                </div>
                        <div class="shipping-info">
                            <h3>Envíos a todo el país por DAC.</h3>
                        </div>
                        <div class="payment-info">
                            <img src="../img/pagos/mercadopago rojo.png" alt="Mercado Pago">
                            <img src="../img/pagos/itau rojo.png" alt="Itau">
                            <img src="../img/pagos/prex rojo.png" alt="Prex">
                            <img src="../img/pagos/oca blue rojo.png" alt="Oca Blue">
                        </div>
                    </div>
                `;
                document.querySelector('.buy-button').addEventListener('click', (e) => {
                    const whatsappNumber = e.target.getAttribute('data-whatsapp');
                    const whatsappUrl = `https://wa.me/${whatsappNumber}?text=Hola,%20estoy%20interesado%20en%20comprar%20el%20libro%20${libro.titulo}%20de%20${libro.autor}`;
                    window.open(whatsappUrl, '_blank');
                });

                // Cargar libros al azar en el carrusel
                const randomBooks = getRandomBooks(data.filter(item => item.id != bookId), 20); 
                const carouselTrack = document.getElementById('carousel-track');
                randomBooks.forEach(libro => {
                    const bookSlide = document.createElement('div');
                    bookSlide.className = 'carousel-slide';
                    bookSlide.innerHTML = `
                        <img src="../../${libro.imagen}" alt="${libro.titulo}">
                        <div class="book-info">
                            <h3 class="book-title">${libro.titulo}</h3>
                            <p class="book-author">${libro.autor}</p>
                            <p class="book-price">${libro.precio}</p>
                            <button class="more-button" onclick="verMas(${libro.id})">Ver más</button>
                        </div>
                    `;
                    carouselTrack.appendChild(bookSlide);
                });

                // Iniciar el carrusel
                initCarousel();
            } else {
                document.getElementById('details-content').innerHTML = '<p>Libro no encontrado.</p>';
            }
        })
        .catch(error => console.error('Error al cargar el archivo JSON:', error));
});

function getRandomBooks(data, count) {
    const shuffled = data.sort(() => 0.5 - Math.random());
    return shuffled.slice(0, count);
}

function verMas(id) {
    window.location.href = `libro-detalle.html?id=${id}`;
}

function toggleMenu() {
    var menu = document.getElementById("nav-menu");
    var body = document.body;
    if (menu.classList.contains('open')) {
        menu.classList.remove('open');
        menu.classList.add('close');
        body.classList.remove('menu-open');
    } else {
        menu.classList.remove('close');
        menu.classList.add('open');
        body.classList.add('menu-open');
    }
}

function initCarousel() {
    const track = document.getElementById('carousel-track');
    const slides = Array.from(track.children);
    const nextButton = document.getElementById('next-button');
    const prevButton = document.getElementById('prev-button');
    const slideWidth = slides[0].getBoundingClientRect().width;

    slides.forEach((slide, index) => {
        slide.style.left = slideWidth * index + 'px';
    });

    let currentSlideIndex = 0;

    nextButton.addEventListener('click', () => {
        currentSlideIndex = (currentSlideIndex + 1) % slides.length;
        track.style.transform = `translateX(-${slideWidth * currentSlideIndex}px)`;
    });

    prevButton.addEventListener('click', () => {
        currentSlideIndex = (currentSlideIndex - 1 + slides.length) % slides.length;
        track.style.transform = `translateX(-${slideWidth * currentSlideIndex}px)`;
    });
}

function addToCart(bookId) {
            const cart = JSON.parse(sessionStorage.getItem('cart')) || [];
            if (!cart.includes(bookId)) {
                cart.push(bookId);
                sessionStorage.setItem('cart', JSON.stringify(cart));
                updateCartCount();
                displayCart();
            }
        }

        function updateCartCount() {
            const cart = JSON.parse(sessionStorage.getItem('cart')) || [];
            document.getElementById('cart-count').textContent = cart.length;
        }

        function displayCart() {
            const cartContainer = document.getElementById('cart-container');
            const cart = JSON.parse(sessionStorage.getItem('cart')) || [];
            const cartList = document.getElementById('cart-list');
            cartList.innerHTML = '';
            cart.forEach(bookId => {
                const book = librosData.find(libro => libro.id === bookId);
                if (book) {
                    const bookElement = document.createElement('div');
                    bookElement.className = 'cart-book';
                    bookElement.innerHTML = `
                        <img src="../../${book.imagen}" alt="${book.titulo}">
                        <div class="cart-info">
                            <h3>${book.titulo}</h3>
                            <p>${book.autor}</p>
                            <p>${book.precio}</p>
                            <button onclick="removeFromCart(${book.id})">Eliminar</button>
                        </div>
                    `;
                    cartList.appendChild(bookElement);
                }
            });
            cartContainer.style.display = cart.length > 0 ? 'block' : 'none';
        }

        function removeFromCart(bookId) {
            let cart = JSON.parse(sessionStorage.getItem('cart')) || [];
            cart = cart.filter(id => id !== bookId);
            sessionStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();
            displayCart();
        }

        // Mostrar/ocultar el contenedor del carrito cuando se hace clic en el ícono del carrito
        document.getElementById('cart-icon-container').addEventListener('click', () => {
            const cartContainer = document.getElementById('cart-container');
            cartContainer.style.display = cartContainer.style.display === 'none' ? 'block' : 'none';
        });

        document.addEventListener('DOMContentLoaded', () => {
            updateCartCount();
            displayCart();
        });
    </script>
</body>
</html>
